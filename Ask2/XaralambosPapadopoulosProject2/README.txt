Το πρόγραμμα mtrace με το που εκτελείται παρσάρει τα ορίσματα που του δόθηκαν και αποφασίζει ποιο δείγμα εξόδου πρέπει να χρησιμοποιηθεί.

Το δείγμα εξόδου 1 παράγεται απο την συνάρτηση exodos1() η οποία παίρνει σαν ορίσματα το domain και μια λίστα απο μηχανήματα η οποία είναι ήδη ταξινομημένη (είτε προέρχεται απο αρχείο είτε απο ορίσματα της γραμμής εντολών είτε είναι απλά το τοπικό μηχάνημα).
Για κάθε μηχάνημα σ' αυτή τη λίστα εκτελείται η εντολή who και για κάθε γραμμή του αποτελέσματος χρησιμοποιείται η εντολή sed για να βρεθεί το userid και το σημείο σύνδεσης του χρήστη που περιγράφεται απο αυτή. Στη συνέχεια υπολογίζεται το όνομα, το επίθετο και η ώρα σύνδεσης του χρήστη στο μηχάνημα με συνδυασμό των εντολών finger και sed. Η ώρα σύνδεσης του χρήστη μετατρέπεται σε timestamp με την εντολή date αφαιρώντας απο αυτή την τρέχουσα ώρα βρίσκουμε διάρκεια παρουσίας του χρήστη στο μηχάνημα. Τέλος με χρήση της εντολής top βρίσκω την διεργασία του χρήστη που απασχολεί πιο πολύ την CPU.
Όλες οι παραπάνω πληροφορίες γράφονται σ' ενα προσωρινό αρχείο (ξεχωριστά για κάθε μηχάνημα) απο το οποίο για κάθε χρήστη κρατάω μόνο τη γραμμή που έχει την μέγιστη απ' όλες διάρκεια παρουσίας με την εντολή awk. Η έξοδος της εντολής αποθηκεύεται σε νέο αρχείο, το οποίο αφού ταξινομηθεί εκτυπώνεται στην οθόνη.

Το δείγμα της εξόδου 2 παράγεται από την συνάρτηση run_exodos2() η οποία παίρνει σαν ορίσματα το domain, το διάστημα δειγματοληψίας (seconds) και μια λίστα απο μηχανήματα η οποία είναι ήδη ταξινομημένη. Η συνάρτηση αυτή φροντίζει σε περίπτωση που ο χρήστης πατήσει το Ctrl-C να κληθεί η συνάρτηση τερματισμού terminate_exodos2 (). Στη συνέχεια ανάλογα με τα δευτερόλεπτα που έχει δώσει ο χρήστης καλεί περιοδικά την συνάρτηση exodos2, η οποία παράγει την έξοδο ενός βήματος της επανάληψης.
Συγκεκριμένα η exodos2() παίρνει σαν ορίσματα το domain και την λίστα με τα μηχανήματα. Σε κάθε μηχάνημα της λίστας βρίσκει τους χρήστες που είναι συνδεδεμένοι με αυτό (με χρήση της εντολής who). Επίσης υπολογίζει το πλήθος των χρηστών και βρίσκει τους μοναδικούς χρήστες ανάλογα με το userid τους. Στη συνέχεια υπολογίζεται ο μέσος φόρτος (πηλίκο του συνολικού αριθμού των μοναδικών χρηστών προς το πλήθος των μηχανημάτων). Τέλος φτιάχνεται ένα γράφημα στο οποίο απεικονίζεται ο μέσος φόρτος των τελευταίων 20 εκτελέσεων της συνάρτησης (στον άξονα 'χ' είναι η ημερομηνία και η ώρα των διαδοχικών εκτελέσεων και στον 'y' οι τιμές του φόρτου). Άν η συνάρτηση έχει εκτελεστεί μέχρι στιγμής λιγότερες από 20 φορές τότε το γράφημα θα έχει λιγότερες απο 20 τιμές. Η συνάρτηση τερματισμού terminate_exodos2 () μόλις κληθεί δημιουργεί tar αρχείο με όλα τα γραφήματα το οποίο αποθηκεύει στο home directory του χρήστη, διαγράφει τα προσωρινά αρχεία που είχαν δημιουργηθεί και μετά τερματίζει με κώδικα 115.

Το δείγμα της εξόδου 3 παράγεται απο την συνάρτηση exodos3() η οποία παίρνει σαν όρισμα το domain και μια λίστα απο μηχανήματα η οποία είναι ήδη ταξινομημένη. Για κάθε ένα απο αυτά τα μηχανήματα διαβάζει όλες τις εγγραφές που επιστρέφει η last και ανάλογα με το είδος της κάθε εγγραφής ενημερώνει διάφορα στατιστικά. Συγκεκριμένα στην περίπτωση που βρεθεί μια απλή εγγραφή σύνδεσης και αποσύνδεσης κάποιου χρήστη βρίσκεται το userid του, τα λεπτά που έμεινε συνδεδεμένος και το σημείο εισδοχής του (όλα με sed). Με βάση αυτές τις τιμές, ενημερώνονται τόσο ο συνολικός χρόνος εργασίας του χρήστη σ' όλα τα μηχανήματα (1ο report της εκφώνησης - χρήση awk), όσο και τα μοναδικά σημεία εισδοχής του χρήστη στο σύστημα (3ο report της εκφώνησης - χρήση awk μέσω συνάρτησης addEntryPoint()) και οι πιο δημοφιλείς μέρες στη διάρκεια των τελευταίων 10 ημερών που έγιναν τα πιο πολλά session (4o report της εκφώνησης - χρήση awk μέσω συνάρτησης addPopularDay()).
Στην περίπτωση που βρεθεί μια εγγραφή για χρήστη που είναι ακόμα συνδεδεμένος στο μηχάνημα (still logged in) τότε γίνονται ακριβώς οι ίδιες διαδικασίες με την προηγούμενη περίπτωση με την διαφορά οτι η διάρκεια σύνδεσης υπολογίζεται με αφαίρεση του χρόνου σύνδεσης απο τον τρέχον χρόνο.
Στην περίπτωση που βρεθεί μια εγγραφή χρήστη που αποσυνδέθηκε χωρίς να κάνει logout (gone - no logout), βρίσκει το userid του, το σημείο εισδοχής του και την ημερομηνία/ώρα σύνδεσης του και ενημερώνει τα μοναδικά σημεία εισδοχής (3ο report) και οι πιο δημοφιλείς μέρες (4o report). Ο συνολικός χρόνος εργασίας του χρήστη (1ο report) δεν ενημερώνεται γιατί αφού ο χρήστης αποσυνδέθηκε χωρις logout δεν μπορούμε να υπολογίσουμε διάρκεια σύνδεσης αφού δεν υπάρχει χρόνος αποσύνδεσης.
Στην περίπτωση που βρεθεί μια εγγραφή χρήστη που το σύστημα έφτασε σε κατάσταση down, υπολογίζεται το userid, η ημερομηνία που έφτασε σε κατάσταση down και το σημείο εισδοχής και ενημερώνονται τα δεδομένα για όλα τα reports.
Στην περίπτωση που βρεθεί μια εγγραφή reboot υπολογίζει την ημερομηνία που έγινε το reboot και ενημερώνει τα δεδομένα για τα reboot (2o report)
Τέλος στην περίπτωση που βρεθεί η εγγραφή wtmp begins, απλά αγνοείται.
Τέλος ταξινομεί αριθμητικά και σε φθίνουσα σειρά τα δεδομένα του report1 και κρατάει απο αυτά μόνο τις πρώτες 100 εγγραφές. Επίσης ταξινομεί τα δεδομένα του report2 και τα δεδομένα του report3. Απο τα τελευταία κρατάει τις 5 πιο δημοφιλείς μέρες και δημιουργεί ένα γράφημα gnuplot (με άξονα 'χ' τις ημέρες και στον 'y' τις συνδέσεις).
Όλα τα παραπάνω reports συγκεντρώνονται σ' ένα tar αρχείο και αφού μετατραπούν σε ascii με κωδικοποίηση base64 στέλνονται στο e-mail του χρήστη.

